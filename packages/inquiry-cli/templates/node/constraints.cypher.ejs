// =============================================================================
// <%= label %> Node Constraints and Indexes
// <%= description %>
//
// @generated by inquiry-cli
// Run these queries in Neo4j Browser or via cypher-shell to set up the schema.
// =============================================================================

// -----------------------------------------------------------------------------
// CONSTRAINTS
// -----------------------------------------------------------------------------

<% for (const prop of properties) { -%>
<% if (prop.unique) { -%>
// Unique constraint on <%= prop.name %>
CREATE CONSTRAINT <%= variableName %>_<%= prop.name %>_unique IF NOT EXISTS
FOR (n:<%= label %>)
REQUIRE n.<%= prop.name %> IS UNIQUE;

<% } -%>
<% } -%>

<% for (const prop of properties) { -%>
<% if (prop.required) { -%>
// Not null constraint on <%= prop.name %> (Neo4j 5.x+)
// CREATE CONSTRAINT <%= variableName %>_<%= prop.name %>_not_null IF NOT EXISTS
// FOR (n:<%= label %>)
// REQUIRE n.<%= prop.name %> IS NOT NULL;

<% } -%>
<% } -%>

// Node key constraint (composite unique) - uncomment if needed
// CREATE CONSTRAINT <%= variableName %>_key IF NOT EXISTS
// FOR (n:<%= label %>)
// REQUIRE (n.prop1, n.prop2) IS NODE KEY;

// -----------------------------------------------------------------------------
// INDEXES
// -----------------------------------------------------------------------------

<% for (const prop of properties) { -%>
<% if (prop.indexed && !prop.unique) { -%>
// Index on <%= prop.name %>
CREATE INDEX <%= variableName %>_<%= prop.name %>_idx IF NOT EXISTS
FOR (n:<%= label %>)
ON (n.<%= prop.name %>);

<% } -%>
<% } -%>

// Composite index example - uncomment and modify if needed
// CREATE INDEX <%= variableName %>_composite_idx IF NOT EXISTS
// FOR (n:<%= label %>)
// ON (n.property1, n.property2);

// Full-text index for search - uncomment if needed
// CREATE FULLTEXT INDEX <%= variableName %>FullText IF NOT EXISTS
// FOR (n:<%= label %>)
// ON EACH [n.name, n.description];

// -----------------------------------------------------------------------------
// TYPE CONSTRAINTS (Neo4j 5.x+ Enterprise)
// -----------------------------------------------------------------------------

// Property type constraints - uncomment for Enterprise Edition
<% for (const prop of properties) { -%>
// CREATE CONSTRAINT <%= variableName %>_<%= prop.name %>_type IF NOT EXISTS
// FOR (n:<%= label %>)
// REQUIRE n.<%= prop.name %> IS :: <%= tsCypherType(prop.type) %>;

<% } -%>

// -----------------------------------------------------------------------------
// EXISTENCE CHECK
// -----------------------------------------------------------------------------

// Verify constraints are created
// SHOW CONSTRAINTS WHERE entityType = 'NODE' AND labelsOrTypes = ['<%= label %>'];

// Verify indexes are created
// SHOW INDEXES WHERE entityType = 'NODE' AND labelsOrTypes = ['<%= label %>'];

// -----------------------------------------------------------------------------
// DROP COMMANDS (for cleanup/reset)
// -----------------------------------------------------------------------------

// Drop all constraints for <%= label %>
// DROP CONSTRAINT <%= variableName %>_id_unique IF EXISTS;
<% for (const prop of properties) { -%>
<% if (prop.unique && prop.name !== 'id') { -%>
// DROP CONSTRAINT <%= variableName %>_<%= prop.name %>_unique IF EXISTS;
<% } -%>
<% } -%>

// Drop all indexes for <%= label %>
<% for (const prop of properties) { -%>
<% if (prop.indexed && !prop.unique) { -%>
// DROP INDEX <%= variableName %>_<%= prop.name %>_idx IF EXISTS;
<% } -%>
<% } -%>
