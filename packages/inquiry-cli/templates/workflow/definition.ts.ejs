/**
 * <%= className %> Definition
 * <%= description %>
 *
 * @generated by inquiry-cli
 */

import type {
  WorkflowDefinition,
  WorkflowStep,
  AgentStep,
  SequentialStep,
  ParallelStep,
  ConditionalStep,
  TransformStep,
  WaitStep,
  WorkflowParameter,
  WorkflowOutput,
  RetryConfig,
} from '../types/index.js';

/**
 * Input parameters for <%= className %>.
 */
export interface <%= classify(name) %>Input {
<% if (preset === 'claim-verification') { -%>
  /** Content to verify claims from */
  content: string;
  /** Optional content type */
  contentType?: string;
  /** Priority for verification */
  priority?: number;
<% } else if (preset === 'research') { -%>
  /** Research topic or query */
  topic: string;
  /** Research scope */
  scope?: 'narrow' | 'medium' | 'broad';
  /** Maximum sources to search */
  maxSources?: number;
<% } else if (preset === 'content-generation') { -%>
  /** Topic for content generation */
  topic: string;
  /** Content format */
  format?: 'article' | 'report' | 'summary' | 'brief';
  /** Target word count */
  targetLength?: number;
<% } else if (preset === 'validation') { -%>
  /** Data to validate */
  data: unknown;
  /** Validation rules to apply */
  rules?: string[];
  /** Whether to fail on first error */
  failFast?: boolean;
<% } else { -%>
  /** Input data for the workflow */
  data: unknown;
<% } -%>
}

/**
 * Output from <%= className %>.
 */
export interface <%= classify(name) %>Output {
<% if (preset === 'claim-verification') { -%>
  /** Extracted claims */
  claims: Array<{
    text: string;
    status: string;
    confidence: number;
    evidence: unknown[];
  }>;
  /** Verification summary */
  summary: string;
  /** Overall confidence score */
  overallConfidence: number;
<% } else if (preset === 'research') { -%>
  /** Research findings */
  findings: Array<{
    title: string;
    content: string;
    source: string;
    relevance: number;
  }>;
  /** Synthesized summary */
  synthesis: string;
  /** Sources consulted */
  sources: string[];
<% } else if (preset === 'content-generation') { -%>
  /** Generated content */
  content: string;
  /** Content metadata */
  metadata: {
    wordCount: number;
    format: string;
    sections: string[];
  };
<% } else if (preset === 'validation') { -%>
  /** Whether validation passed */
  isValid: boolean;
  /** Validation errors */
  errors: Array<{
    field: string;
    message: string;
    code: string;
  }>;
  /** Validated data */
  validatedData: unknown;
<% } else { -%>
  /** Result of the workflow */
  result: unknown;
  /** Processing metadata */
  metadata?: Record<string, unknown>;
<% } -%>
}

/**
 * Default retry configuration for <%= className %>.
 */
export const <%= variableName %>RetryConfig: RetryConfig = {
  maxAttempts: 3,
  initialDelayMs: 1000,
  maxDelayMs: 30000,
  backoffMultiplier: 2,
};

/**
 * Input parameters definition for <%= className %>.
 */
export const <%= variableName %>Parameters: WorkflowParameter[] = [
<% if (preset === 'claim-verification') { -%>
  {
    name: 'content',
    type: 'string',
    description: 'Content to verify claims from',
    required: true,
  },
  {
    name: 'contentType',
    type: 'string',
    description: 'Content type (article, social, document)',
    required: false,
    defaultValue: 'article',
  },
  {
    name: 'priority',
    type: 'number',
    description: 'Verification priority (1-5)',
    required: false,
    defaultValue: 3,
  },
<% } else if (preset === 'research') { -%>
  {
    name: 'topic',
    type: 'string',
    description: 'Research topic or query',
    required: true,
  },
  {
    name: 'scope',
    type: 'string',
    description: 'Research scope',
    required: false,
    defaultValue: 'medium',
  },
  {
    name: 'maxSources',
    type: 'number',
    description: 'Maximum sources to search',
    required: false,
    defaultValue: 10,
  },
<% } else if (preset === 'content-generation') { -%>
  {
    name: 'topic',
    type: 'string',
    description: 'Topic for content generation',
    required: true,
  },
  {
    name: 'format',
    type: 'string',
    description: 'Content format',
    required: false,
    defaultValue: 'article',
  },
  {
    name: 'targetLength',
    type: 'number',
    description: 'Target word count',
    required: false,
    defaultValue: 1000,
  },
<% } else if (preset === 'validation') { -%>
  {
    name: 'data',
    type: 'object',
    description: 'Data to validate',
    required: true,
  },
  {
    name: 'rules',
    type: 'array',
    description: 'Validation rules',
    required: false,
  },
  {
    name: 'failFast',
    type: 'boolean',
    description: 'Fail on first error',
    required: false,
    defaultValue: false,
  },
<% } else { -%>
  {
    name: 'data',
    type: 'object',
    description: 'Input data',
    required: true,
  },
<% } -%>
];

/**
 * Output definitions for <%= className %>.
 */
export const <%= variableName %>Outputs: WorkflowOutput[] = [
<% if (preset === 'claim-verification') { -%>
  { name: 'claims', type: 'array', source: 'output.claims', description: 'Verified claims' },
  { name: 'summary', type: 'string', source: 'output.summary', description: 'Verification summary' },
  { name: 'overallConfidence', type: 'number', source: 'output.overallConfidence', description: 'Overall confidence' },
<% } else if (preset === 'research') { -%>
  { name: 'findings', type: 'array', source: 'output.findings', description: 'Research findings' },
  { name: 'synthesis', type: 'string', source: 'output.synthesis', description: 'Synthesized summary' },
  { name: 'sources', type: 'array', source: 'output.sources', description: 'Sources consulted' },
<% } else if (preset === 'content-generation') { -%>
  { name: 'content', type: 'string', source: 'output.content', description: 'Generated content' },
  { name: 'metadata', type: 'object', source: 'output.metadata', description: 'Content metadata' },
<% } else if (preset === 'validation') { -%>
  { name: 'isValid', type: 'boolean', source: 'output.isValid', description: 'Validation result' },
  { name: 'errors', type: 'array', source: 'output.errors', description: 'Validation errors' },
  { name: 'validatedData', type: 'object', source: 'output.validatedData', description: 'Validated data' },
<% } else { -%>
  { name: 'result', type: 'object', source: 'output.result', description: 'Workflow result' },
<% } -%>
];

<% for (const step of steps) { -%>
/**
 * Step: <%= step.name %>
 * <%= step.description || step.name %>
 */
<% if (step.type === 'agent') { -%>
export const <%= step.variableName %>: AgentStep = {
  id: '<%= step.id %>',
  name: '<%= step.name %>',
  type: 'agent',
  description: '<%= step.description || step.name %>',
  agentId: '<%= step.agentId || step.name %>',
  priority: 'normal',
  retry: <%= variableName %>RetryConfig,
  inputMappings: [
    { source: 'input', target: 'data', required: true },
  ],
  outputMappings: [
    { source: 'result', target: 'steps.<%= step.name %>' },
  ],
};

<% } else if (step.type === 'sequential') { -%>
export const <%= step.variableName %>: SequentialStep = {
  id: '<%= step.id %>',
  name: '<%= step.name %>',
  type: 'sequential',
  description: '<%= step.description || step.name %>',
  steps: [
    // TODO: Add child steps
  ],
  stopOnError: true,
};

<% } else if (step.type === 'parallel') { -%>
export const <%= step.variableName %>: ParallelStep = {
  id: '<%= step.id %>',
  name: '<%= step.name %>',
  type: 'parallel',
  description: '<%= step.description || step.name %>',
  steps: [
    // TODO: Add parallel steps
  ],
  maxConcurrency: 5,
  failureStrategy: 'waitAll',
  minSuccessful: 1,
};

<% } else if (step.type === 'conditional') { -%>
export const <%= step.variableName %>: ConditionalStep = {
  id: '<%= step.id %>',
  name: '<%= step.name %>',
  type: 'conditional',
  description: '<%= step.description || step.name %>',
  condition: {
    field: 'context.shouldContinue',
    operator: 'isTrue',
  },
  thenStep: {
    id: '<%= step.id %>-then',
    name: '<%= step.name %>-continue',
    type: 'agent',
    agentId: 'continue-agent',
  } as AgentStep,
  elseStep: undefined,
};

<% } else if (step.type === 'transform') { -%>
export const <%= step.variableName %>: TransformStep = {
  id: '<%= step.id %>',
  name: '<%= step.name %>',
  type: 'transform',
  description: '<%= step.description || step.name %>',
  expression: 'input',
  language: 'jsonpath',
  inputVariable: 'input',
  outputVariable: 'transformed',
};

<% } else if (step.type === 'wait') { -%>
export const <%= step.variableName %>: WaitStep = {
  id: '<%= step.id %>',
  name: '<%= step.name %>',
  type: 'wait',
  description: '<%= step.description || step.name %>',
  waitType: 'duration',
  durationMs: 1000,
};

<% } -%>
<% } -%>
/**
 * All steps for <%= className %>.
 */
export const <%= variableName %>Steps: WorkflowStep[] = [
<% for (const step of steps) { -%>
  <%= step.variableName %>,
<% } -%>
];

/**
 * <%= className %> definition.
 */
export const <%= variableName %>Definition: WorkflowDefinition = {
  id: '<%= name %>',
  name: '<%= className %>',
  description: '<%= description %>',
  version: '1.0.0',
  status: 'active',
  triggers: [
    {
      type: 'api',
      config: { enabled: true },
    },
  ],
  parameters: <%= variableName %>Parameters,
  outputs: <%= variableName %>Outputs,
  entryStepId: '<%= steps.length > 0 ? steps[0].id : "entry" %>',
  steps: <%= variableName %>Steps,
  retryConfig: <%= variableName %>RetryConfig,
  timeoutMs: 300000, // 5 minutes
  requiredAgents: [
<% for (const step of steps) { -%>
<% if (step.type === 'agent' && step.agentId) { -%>
    '<%= step.agentId %>',
<% } -%>
<% } -%>
  ],
  tags: ['<%= preset %>', 'generated'],
  createdAt: Date.now(),
  updatedAt: Date.now(),
  createdBy: 'inquiry-cli',
};
